import ".../Typings.pkl"
import ".../Index.pkl"

class SmartRCDPrototype extends Typings.RCDPrototype {
}

const local function getIDs(v: Index.Content): Set<String> =
    v.filter((p) -> p is SmartRCDPrototype).map((p) -> p.id).toSet()

output: Index.TransformFunction = (v) -> v.add(new Typings.EntityPrototype {
    parent { "BaseItem" }
    id = "RCD"
    components {
        new Typings.RCDComponent {
            availablePrototypes = getIDs(v)
        }
        new Typings.LimitedChargesComponent {
            maxCharges = 30
            charges = 30
        }
        new Typings.UseDelayComponent {}
        new Typings.SpriteComponent {
            sprite = "/Textures/Objects/Tools/rcd.rsi"
            state = "icon"
        }
        new Typings.ItemComponent {
            size = "Normal"
        }
        new Typings.ClothingComponent {
            sprite = "/Textures/Objects/Tools/rcd.rsi"
            quickEquip = false
            slots = "BELT"
        }
        new Typings.PhysicalCompositionComponent {
            materialComposition {
                ["Steel"] = 400
                ["Plastic"] = 100
                ["Circuitry"] = 50
            }
        }
        new Typings.StaticPriceComponent {
            price = 100.0
        }
        new Typings.UserInterfaceComponent {
            interfaces {
                ["enum.RcdUiKey.Key"] {
                    type = "RCDMenuBoundUserInterface"
                }
            }
        }
        new Typings.ActivatableUIComponent {
            key = "enum.RcdUiKey.Key"
        }
        new Typings.ReverseEngineeringComponent {
            difficulty = 3
            recipes {
                "RCD"
            }
        }
        new Typings.FixturesComponent {
            fixtures {
                ["fix1"] {
                    shape = new Typings.PhysShapeAabb {
                        bounds = Typings.Box2(-0.25, -0.25, 0.25, 0.25)
                    }
                    density = 65.0
                    mask = Set("ItemMask")
                    restitution = 0.3
                    friction = 0.2
                }
            }
        }
    }
}).add(new Typings.EntityPrototype {
    parent { "RCD" }
    id = "RCDEmpty"
    components {
        new Typings.LimitedChargesComponent {
            charges = 0
        }
    }
}).add(new Typings.EntityPrototype {
    parent { "RCD" }
    id = "RCDRecharging"
    suffix = "AutoRecharge"
    components {
        new Typings.LimitedChargesComponent {
            maxCharges = 20
            charges = 20
        }
        new Typings.AutoRechargeComponent {
            rechargeDuration = "10"
        }
    }
}).add(new Typings.EntityPrototype {
    parent { "RCD" }
    id = "RCDExperimental"
    suffix = "Admeme"
    name = "experimental RCD"
    description = "A bluespace-enhanced rapid construction device that passively generates its own compressed matter."
    components {
        new Typings.AutoRechargeComponent {
            rechargeDuration = "1"
        }
    }
})
